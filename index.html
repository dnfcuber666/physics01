<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>2D 氣體分子運動模擬</title>
  <style>
    body { text-align: center; background: #f5f5f5; font-family: sans-serif; }
    canvas { background: #fff; display: block; margin: 10px auto; border: 1px solid #ccc; }
    .controls { margin: 10px; }
    input, button { margin: 5px; }
  </style>
</head>
<body>
  <h1>2D 氣體分子運動模擬</h1>
  <div class="controls">
    <label>初始溫度: <input type="range" id="tempInput" min="1000" max="100000" value="4000" step="100"></label>
    <span id="tempValue">4000</span>
    <button id="startBtn">開始</button>
    <button id="resetBtn">重設</button>
    <button id="randomBtn">隨機化速度</button>
  </div>
  <canvas id="simCanvas" width="600" height="400"></canvas>

  <script>
    const canvas = document.getElementById("simCanvas");
    const ctx = canvas.getContext("2d");
    let particles = [];
    let numParticles = 50;
    let radius = 5;
    let initialTemp = 4000;
    let running = false;

    // 更新顯示溫度值
    const tempInput = document.getElementById("tempInput");
    const tempValue = document.getElementById("tempValue");
    tempInput.addEventListener("input", () => {
      tempValue.textContent = tempInput.value;
    });

    function initParticles() {
      particles = [];
      let speedScale = Math.sqrt(initialTemp) / 100;
      for (let i = 0; i < numParticles; i++) {
        let angle = Math.random() * 2 * Math.PI;
        let speed = speedScale * (0.5 + Math.random());
        particles.push({
          x: Math.random() * (canvas.width - 2 * radius) + radius,
          y: Math.random() * (canvas.height - 2 * radius) + radius,
          vx: speed * Math.cos(angle),
          vy: speed * Math.sin(angle),
          radius: radius
        });
      }
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let p of particles) {
        p.x += p.vx;
        p.y += p.vy;
        if (p.x - p.radius < 0 || p.x + p.radius > canvas.width) p.vx *= -1;
        if (p.y - p.radius < 0 || p.y + p.radius > canvas.height) p.vy *= -1;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
        ctx.fill();
      }
      if (running) requestAnimationFrame(update);
    }

    document.getElementById("startBtn").onclick = () => {
      if (!running) {
        initialTemp = parseFloat(tempInput.value);
        tempInput.disabled = true;
        initParticles();
        running = true;
        update();
      }
    };

    document.getElementById("randomBtn").onclick = () => {
      if (running) {
        let speedScale = Math.sqrt(initialTemp) / 100;
        for (let p of particles) {
          let angle = Math.random() * 2 * Math.PI;
          let speed = speedScale * (0.5 + Math.random());
          p.vx = speed * Math.cos(angle);
          p.vy = speed * Math.sin(angle);
        }
      }
    };

    document.getElementById("resetBtn").onclick = () => {
      running = false;
      tempInput.disabled = false;
      initParticles();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    initParticles();
  </script>
</body>
</html>
